# Memory Skill 参数简化设计文档

## 概述

简化 memory skill 的参数设计，改为直接接受文件路径，提升易用性和灵活性。

**日期：** 2026-02-26
**变更级别：** feat

---

## 方案选择

### 方案对比

| 方案 | 核心思路 | 优点 | 缺点 |
|------|----------|------|------|
| A - 直接文件路径参数 | 接受任意数量的文件路径，无参数前缀 | 简洁直观，符合 Unix 命令行习惯，灵活 | 类型识别依赖路径规范 |
| B - 保持 -- 参数格式 | 保持 `--` 前缀，合并为单个参数 | 保持参数格式一致性 | 参数值需解析逗号分隔，不够简洁 |

### 推荐方案

**方案 A - 直接文件路径参数**

**理由：**
1. 更简洁直观
2. 符合 Unix 命令行习惯（如 `grep`, `cat` 等工具）
3. 更灵活，支持任意文件组合
4. 目录名称规范已有约定，类型识别可靠

---

## 架构设计

### memory skill 参数变更

**新的调用方式：**

```bash
# 单个文件
/memory docs/spec/xxx.spec.md
/memory docs/tasks/xxx.tasks.md
/memory docs/changes/xxx.md

# 多个文件
/memory docs/spec/xxx.spec.md docs/tasks/xxx.tasks.md
/memory docs/spec/xxx.spec.md docs/tasks/xxx.tasks.md docs/plans/xxx-design.md

# 首次初始化（无参数）
/memory
```

---

## 模块划分

### memory skill 更新内容

| 模块 | 更新内容 |
|------|----------|
| 参数解析 | 解析所有非选项参数作为文件路径 |
| 类型识别 | 根据路径中的 `spec/`、`tasks/`、`changes/`、`plans/` 识别类型 |
| 文件处理 | 读取传入的文件，提取对应信息 |

### 文件类型映射

| 路径包含 | 类型 | 提取信息 | 更新位置 |
|----------|------|----------|----------|
| `docs/spec/` | spec | 项目概述（Goal 部分） | 项目概述章节 |
| `docs/tasks/` | tasks | 已完成功能（Execution Record） | 已完成功能列表 |
| `docs/changes/` | changes | 变更摘要（Scope/Execution Record） | 文件索引 Summary 列 |
| `docs/plans/` | design | 架构要点、关键决策 | 架构要点、关键决策记录 |

---

## 数据流

```
开始
  │
  ▼
解析参数（所有非选项参数）
  │
  ▼
无参数？
  │
  ├── 是 ──→ 扫描所有文件（首次初始化）
  │
  └── 否
       │
       ▼
  遍历文件路径
       │
       ▼
  识别文件类型
  (spec/tasks/changes/plans)
       │
       ▼
  读取文件内容
       │
       ▼
  ┌─────────────────────────────┐
  │ 根据类型提取信息          │
  │ - spec: 项目概述         │
  │ - tasks: 已完成功能      │
  │ - changes: 变更摘要      │
  │ - design: 架构/决策      │
  └──────────┬──────────────────┘
             │
             ▼
  更新 memory.md
  - 更新对应章节
  - 更新文件索引表格
             │
             ▼
           完成
```

---

## 错误处理

| 错误场景 | 处理方式 |
|----------|----------|
| 传入的文件不存在 | 报错并终止 |
| 无法识别文件类型 | 警告但继续，仅更新文件索引 |
| memory.md 写入失败 | 报错并保留原文件（如有） |

---

## 测试策略

| 测试场景 | 验证内容 |
|----------|----------|
| 单个 spec 文件 | 正确提取项目概述 |
| 单个 tasks 文件 | 正确提取已完成功能 |
| 单个 changes 文件 | 正确提取变更摘要并更新文件索引 |
| 单个 design 文件 | 正确提取架构要点和关键决策 |
| 多个文件组合 | 正确处理多个文件 |
| 无参数 | 首次初始化正常工作 |

---

## 关键决策

| 决策 | 选择 | 理由 |
|------|------|------|
| 参数格式 | 直接文件路径 | 简洁直观，符合 Unix 命令行习惯 |
| 类型识别方式 | 路径目录名称 | 目录规范已有约定，识别可靠 |
| changes 摘要位置 | 文件索引 Summary 列 | 避免增加新章节，保持结构简洁 |
