# Spec：重构治理框架入口 - 去掉 classify 技能

**版本：** 1.0
**日期：** 2026-02-25
**状态：** Draft

---

## 1. Goal

简化治理框架入口，去掉 classify 技能，将变更分级决策树直接整合到 CLAUDE.md 中，并在 /fix 和 /feat 技能中实现两阶段边界检查，支持自动路由到正确的技能流程。

---

## 2. Non-Goals

- 不改变变更分级的核心定义（docs/fix/feat 的判断标准保持不变）
- 不改变其他技能（explore、design、doc-gen、execute）的行为
- 不改变受保护目录的规则
- 不实现技能间的自动调用机制（通过提示用户手动切换）

---

## 3. Constraints

- 所有变更级别命名必须统一使用小写：docs、fix、feat
- 两阶段检查必须实现（启动时 + 探索阶段）
- 级别不匹配时必须输出清晰的路由提示
- CLAUDE.md 中的规则必须以决策树形式呈现
- 必须完全删除 classify 技能目录

---

## 4. 变更级别定义

### 4.1 docs — Docs / Trivial Changes

满足以下**全部**条件：

- 仅修改文档或注释（README.md、docs/guide/**、*.md、代码注释）
- **不修改治理文档**（docs/spec/、docs/tasks/、docs/changes/）
- 不改变代码运行行为
- 不改变公共接口
- 不改变默认值或配置语义
- 不新增或修改依赖

**处理方式：** 直接对话，无需技能

### 4.2 fix — Tiny / Controlled Changes

满足以下**任一**条件，且**不涉及** feat 触发条件：

- 小 bug 修复
- typo 修复
- 单文件逻辑修正
- 内部实现优化（不改变接口与语义）

**边界约束：**
- 不改变公共接口（API/CLI/配置项对外契约）
- 不改变默认值或配置语义
- 不新增或升级依赖
- 不涉及跨模块架构调整

**处理方式：** `/fix <需求描述>`

### 4.3 feat — Full Feature Changes

满足以下**任一**条件：

- 新功能开发
- 公共接口变更
- 默认值或配置语义变更
- 依赖变更
- 多模块改动
- 架构调整
- 安全 / 加密 / 账务相关变更

**处理方式：** `/feat <需求描述>`

---

## 5. 接口与数据结构

### 5.1 CLAUDE.md 变更分级入口规则

**格式：** 决策树（ASCII Art）

**内容要求：**
- 三级判断流程
- 每个节点说明判断条件
- 叶子节点指向对应的处理方式

### 5.2 fix/SKILL.md 边界检查

**位置：** 文件顶部，现有内容之前

**阶段 1 检查内容：**
```markdown
## 边界检查（阶段 1：启动时）

检查用户需求是否触发以下 feat 条件：
- [feat 触发条件列表]

如果触发，输出：
```
检测到这是一个 feat 级别变更。

触发条件：[具体条件]

请使用：/feat <你的需求描述>
```
```

**阶段 2 检查内容：**
```markdown
## 边界检查（阶段 2：探索时）

在 /explore 阶段，如果发现需求超出以下 fix 边界：
- [fix 边界列表]

输出：
```
经探索确认，需求超出 fix 级别边界。

超出范围：[具体范围]

请使用：/feat <你的需求描述>
```
```

### 5.3 feat/SKILL.md 边界检查

**位置：** 文件顶部，现有内容之前

**阶段 1 检查内容：**
```markdown
## 边界检查（阶段 1：启动时）

检查用户需求是否仅满足 docs 级别条件（且不触发 feat 条件）：
- [docs 级别条件列表]

如果满足，输出：
```
这是一个 docs 级别变更。

docs 级别无需使用技能，请直接描述你需要的修改。
```
```

---

## 6. 边界检查逻辑

### 6.1 fix 启动时检查

**输入：** 用户需求描述

**检查逻辑：**
```
FOR EACH feat 触发条件 IN [新功能, 接口变更, 默认值变更, 依赖变更, 多模块, 架构调整, 安全/加密/账务]
    IF 需求匹配条件 THEN
        RETURN "路由到 /feat"
    END IF
END FOR

RETURN "继续 fix 流程"
```

### 6.2 feat 启动时检查

**输入：** 用户需求描述

**检查逻辑：**
```
// 先检查是否触发 feat
IF 需求匹配任一 feat 条件 THEN
    RETURN "继续 feat 流程"
END IF

// 再检查是否属于 docs
IF 需求仅修改文档或注释 THEN
    RETURN "提示直接对话"
END IF

// 如果都不是，可能是 fix，但用户选了 feat
RETURN "继续 feat 流程（倾向更高级别）"
```

---

## 7. 删除内容

### 7.1 classify 技能目录

**路径：** `skills/classify/`

**包含文件：**
- `skills/classify/SKILL.md`

**操作：** 完全删除

---

## 8. 命名统一

### 8.1 Docs → docs

**影响文件：**
- CLAUDE.md
- skills/docs/SKILL.md

**替换规则：**
- "Docs 级别" → "docs 级别"
- "Docs — Docs / Trivial Changes" → "docs — Docs / Trivial Changes"
- "满足以下 Docs 条件" → "满足以下 docs 条件"

---

## 9. Validation Plan

### 9.1 决策树完整性验证

| 需求描述 | 期望级别 | 验证方法 |
|---------|---------|---------|
| 修改 README 错别字 | docs | 遍历决策树 |
| 修复代码注释 | docs | 遍历决策树 |
| 修复函数 bug | fix | 遍历决策树 |
| 修复 typo | fix | 遍历决策树 |
| 新增 API | feat | 遍历决策树 |
| 升级依赖 | feat | 遍历决策树 |
| 重构模块 | feat | 遍历决策树 |

### 9.2 边界检查验证

| 测试输入 | 期望输出 |
|---------|---------|
| /fix "修复 xxx bug" | 通过检查 |
| /fix "新增 API 接口" | 路由到 /feat |
| /feat "修改 README 错别字" | 提示直接对话 |

### 9.3 回归验证

| 验证项 | 方法 |
|-------|------|
| /explore 行为不变 | 执行正常流程 |
| /design 行为不变 | 执行正常流程 |
| /doc-gen 行为不变 | 执行正常流程 |
| /execute 行为不变 | 执行正常流程 |
| 受保护目录规则不变 | 尝试直接修改，确认拒绝 |

---

## 10. 附录

### 10.1 变更级别快速参考

| 级别 | 触发条件 | 处理方式 |
|------|---------|---------|
| docs | 仅修改文档/注释 | 直接对话 |
| fix | 小修复、单文件、内部优化 | /fix |
| feat | 新功能、接口变更、依赖、架构、安全 | /feat |

### 10.2 边界冲突处理原则

当需求同时满足多个级别条件时：
- **优先选择更高级别**（fix → feat）
- **倾向于更保守的处理方式**（确保设计充分）
